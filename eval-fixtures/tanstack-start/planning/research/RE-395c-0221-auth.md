# Research: Adding Auth to TanStack Start

**Workflow:** RE-395c-0221
**Date:** 2026-02-21
**Status:** Complete

## Context

This TanStack Start app is a fresh scaffold with React 19, TanStack Router (file-based routing), Tailwind CSS 4, and Vite 7. No auth, server functions, middleware, or session handling exist yet. The app uses SSR with streaming via Vinxi/Nitro under the hood.

## Research Questions

1. What auth solutions have first-class TanStack Start support?
2. What are the trade-offs (cost, control, DX, features)?
3. What does the TanStack team recommend?

## Key Finding: TanStack Start's Auth Stance

TanStack Start is **auth-agnostic** -- it provides primitives (`createMiddleware()`, `beforeLoad` route guards, server functions) and maintains official examples for several providers. No single solution is blessed.

Official examples in the TanStack Router monorepo:
- `start-basic-auth` -- DIY session-based
- `start-basic-authjs` -- Auth.js
- `start-clerk-basic` -- Clerk
- `start-supabase-basic` -- Supabase Auth
- `start-workos` -- WorkOS AuthKit

---

## Comparison Matrix

| Solution | TS Start Support | Type | Free Tier | OSS | Best For |
|----------|-----------------|------|-----------|-----|----------|
| **Better Auth** | First-class (docs + plugin) | Self-hosted lib | Unlimited | Yes (MIT) | Full control, self-hosted |
| **Clerk** | First-class (SDK + example) | Managed SaaS | 10-50K MAU | No | Fastest DX, pre-built UI |
| **Auth.js** | Partial (example exists) | Self-hosted lib | Unlimited | Yes | Max provider breadth (80+) |
| **Supabase Auth** | First-class (docs + example) | BaaS platform | 50K MAU | Yes | Already using Supabase |
| **WorkOS AuthKit** | First-class (SDK + example) | Managed SaaS | 1M MAU | No | Enterprise SSO/SCIM |
| **Firebase Auth** | No integration | Managed SaaS | 50K MAU | No | Already in Google ecosystem |
| **Lucia** | None | **Deprecated** | N/A | N/A | Don't use -- successor is Better Auth |

---

## Deep Dive: Top 3 Recommendations

### 1. Better Auth -- Best for self-hosted / full control

- **Integration:** `tanstackStartCookies()` plugin, mount handler at `/api/auth/$` server route
- **Pattern:** Session-based with database-backed sessions (Drizzle, Prisma, etc.)
- **Features:** Email/password, social OAuth, magic links, passkeys, 2FA, org management
- **Stats:** ~24.8K GitHub stars, ~611K weekly npm downloads, YC-backed
- **Trade-off:** You manage the database and infrastructure. Newer library (emerged 2024-2025).

```
npm install better-auth
```

Route protection pattern:
```ts
// src/routes/dashboard.tsx
export const Route = createFileRoute('/dashboard')({
  beforeLoad: async () => {
    const session = await getSession()
    if (!session) throw redirect({ to: '/login' })
  },
  component: Dashboard,
})
```

### 2. Clerk -- Best for speed-to-production

- **Integration:** `@clerk/tanstack-react-start` SDK, `clerkMiddleware()` in request middleware
- **Pattern:** JWT-based, Clerk manages infrastructure entirely
- **Features:** Pre-built `<SignIn>`, `<SignUp>`, `<UserButton>` components, hooks (`useAuth()`, `useUser()`), user management dashboard, webhooks
- **Pricing:** Free 10-50K MAU, then $0.02/MAU
- **Trade-off:** Vendor lock-in. User data lives on Clerk's servers.

```
npm install @clerk/tanstack-react-start
```

### 3. WorkOS AuthKit -- Best for B2B / enterprise

- **Integration:** `@workos/authkit-tanstack-react-start` SDK (released Nov 2025)
- **Pattern:** Session-based with auto-refresh middleware
- **Features:** SSO (SAML/OIDC), SCIM directory sync, social login, admin portal
- **Pricing:** 1M MAU free (!), then $125/SSO connection/month
- **Trade-off:** Overkill for consumer apps. Enterprise SSO connections are expensive at scale.

---

## Decision Framework

```
Do you need enterprise SSO/SCIM?
  YES --> WorkOS AuthKit
  NO  --> Continue

Do you want to own your auth data/infra?
  YES --> Better Auth (self-hosted, OSS)
  NO  --> Continue

Do you want the fastest possible setup?
  YES --> Clerk (managed, pre-built UI)
  NO  --> Continue

Are you already using Supabase?
  YES --> Supabase Auth
  NO  --> Better Auth or Clerk
```

## What This App Needs

Given this is a fresh TanStack Start app with no existing infrastructure decisions:

1. **Server route** at `/api/auth/*` (or similar) for auth endpoints
2. **Middleware** in `createStart()` config for session validation on every request
3. **Route guards** via `beforeLoad` on protected routes
4. **Auth context provider** wrapping the app for client-side auth state
5. **Login/signup pages** as new routes under `src/routes/`
6. **Database** (if self-hosted) -- SQLite for dev, Postgres for production

## Recommendation

**Better Auth** is the strongest default choice for this project because:
- First-class TanStack Start support with dedicated plugin
- Self-hosted = full data ownership, no MAU costs
- Session-based auth (the pattern TanStack Start is designed around)
- TypeScript-first with auto-generated database schemas
- Active development, strong community momentum (YC-backed)
- Natural successor to the popular Lucia library

**Use Clerk instead** if shipping speed matters more than data ownership, or if you want pre-built UI components out of the box.

---

## Sources

- [TanStack Start Authentication Guide](https://tanstack.com/start/latest/docs/framework/react/guide/authentication)
- [TanStack Start Middleware Guide](https://tanstack.com/start/latest/docs/framework/react/guide/middleware)
- [Better Auth TanStack Integration](https://www.better-auth.com/docs/integrations/tanstack)
- [Clerk TanStack Start Quickstart](https://clerk.com/docs/tanstack-react-start/getting-started/quickstart)
- [WorkOS AuthKit TanStack Start SDK](https://workos.com/docs/sdks/authkit-tanstack-start)
- [Supabase TanStack Start Quickstart](https://supabase.com/docs/guides/getting-started/quickstarts/tanstack)
- [Lucia Auth Deprecation](https://github.com/lucia-auth/lucia/discussions/1714)
